<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="https://centerforassessment.github.io/assets/favicon.png" sizes="16x16">
<meta property="og:title" content="NCME 2022 Training Session • Multiple Imputation with Simulated Missing Data">
<meta property="og:description" content="NCME 2022 Training Session • Multiple Imputation with Simulated Missing Data">
<meta property="og:type" content="website">
<meta property="og:url" content="https://centerforassessment.github.io/NCME 2022 Training Session">
<meta property="og:image" content="https://centerforassessment.github.io/assets/favicon.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@NCIEA1">
<meta name="twitter:creator" content="@dbetebenner">
<meta name="twitter:image" content="https://centerforassessment.github.io/assets/favicon.png">
<meta name="twitter:title" content="NCME 2022 Training Session • Multiple Imputation with Simulated Missing Data">
<meta name="twitter:description" content="NCME 2022 Training Session • Multiple Imputation with Simulated Missing Data">
<title>NCME 2022 Training Session • Multiple Imputation with Simulated Missing Data</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- Fonts --><link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400" rel="stylesheet" type="text/css">
<!-- packagePages --><link href="../../packagePages.css" rel="stylesheet">
<link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- gist-embed --><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.4/gist-embed.min.js"></script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="https://centerforassessment.github.io"></a><a class="navbar-label" href="../../index.html">NCME 2022 Training Session</a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Presentations
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/presentations/Overview_and_Background.html">Presentation 1: April 10th, 1:00 to 2:00</a>
    </li>
    <li>
      <a href="../../articles/presentations/Software_Preparations.html">Presentation 2: April 10th, 2:00 to 2:30</a>
    </li>
    <li>
      <a href="../../articles/presentations/Academic_Impact_Part_1.html">Presentation 3: April 10th, 2:45 to 3:45</a>
    </li>
    <li class="dropdown-header">Presentation 4: April 10th, 3:45 to 4:45</li>
    <li>
      <a href="../../articles/presentations/MI_w_Missing_Data.html">Presentation 5: April 11th, 1:00 to 3:00</a>
    </li>
    <li>
      <a href="../../articles/presentations/Academic_Impact_Part_2.html">Presentation 6: April 11th, 3:15 to 4:45</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Documents
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/vignettes/Considering_Participation.html">Considering Participation</a>
    </li>
    <li>
      <a href="../../articles/vignettes/Missing_Data_Multiple_Imputation.html">Multiple Imputation with Simulated Missing Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">NCME 2022 Training Session</li>
    <li>
      <a href="../../articles/releases/NCME_2022_Training_Session_Notes.html">April 2022</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/centerforassessment/NCME_2022_Training_Session">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
   <a style="cursor:pointer" onclick="window.open('https://twitter.com/intent/tweet?url=https%3A%2F%2Fcenterforassessment.github.io%2FNCME_2022_Training_Session%2F&amp;via=NCIEA1&amp;text=NCME%202022:%20Data%20Visualization%20and%20Analysis%20in%20the%20Era%20of%20COVID-19&amp;hashtags=NCME%2CNCME22%2CNCME2022%2Crstats','','scrollbars=0,menubar=0,height=300,width=600,resizable=0,toolbar=0,location=0,status=0')">
    <span class="fab fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="Missing_Data_Multiple_Imputation_files/header-attrs-2.13/header-attrs.js"></script><link href="Missing_Data_Multiple_Imputation_files/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet">
<link href="Missing_Data_Multiple_Imputation_files/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet">
<script src="Missing_Data_Multiple_Imputation_files/anchor-sections-1.1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Multiple Imputation with Simulated Missing Data</h1>
            <h3 class="subtitle">Virtual Training Session<br>NCME Annual Meeting 2022</h3>
                        <h4 class="author">Adam Van Iwaarden</h4>
            
            <h4 class="date">April 13th, 2022</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1 hasAnchor">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a>
</h1>
<p>While planning and discussing the analysis of student assessment data with our state partners in the spring of 2021, The Center for Assessment received varying anecdotal reports of what might be expected in terms of reduced test participation due to the ongoing COVID-19 pandemic. The only certainty afforded to education state department staff, policy makers and data analysts alike was that the typical regime of census student testing was unlikely and that new methods for confronting missing data problems would be required in short time. In preparation for these unprecedented circumstances, we first conducted simulations to produce varying degrees and patterns of missing data that would then allow for a rigorous exploration of methods to address the problems in data analysis and questions in reporting results to stakeholders and the public.</p>
<p>This vignette is an attempt to reconstruct our early efforts to understand the impact that missing data could have on the Student Growth Percentiles (SGP) analyses we conduct annually in cooperation with state departments of education (typically for accountability purposes), as well as the methodological vetting processes we used to eventually select a multiple imputation approach to address these problems. Although these initial efforts led to the development of customized <code>R</code> functions included in the <code>cfaTools</code> package that allowed us to apply these analytic techniques universally to our state clients, the functions used in this exercise are restricted to the widely available and well documented functions and packages upon which our functions are based. The data management and bookkeeping steps included in this document and supporting <code>R</code> code follow those we used in our data analysis workflow over the past year. Specifically, the section on missing data corresponds to the <a href="https://centerforassessment.github.io/cfaTools/reference/amputeScaleScore.html"><code>amputeScaleScore</code> function</a> to simulate, explore and analyze missing data patterns<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, and the multiple imputation exercises mirror what is accomplished in the <a href="https://centerforassessment.github.io/cfaTools/reference/imputeScaleScore.html"><code>imputeScaleScore</code> function</a>.</p>
<p>As with our early simulation studies, this training vignette uses the <code>sgpData_LONG_COVID</code> data available from the <a href="https://github.com/CenterForAssessment/SGPdata"><code>SGPData</code></a> package. This simulated data conforms to the naming and structural conventions <a href="https://centerforassessment.github.io/SGPdata/reference/index.html#section-data-sets-for-higher-level-sgp-functions">required for data</a> analysis using the <a href="https://github.com/CenterForAssessment/SGP">SGP package</a>.</p>
<p>The <code>R</code> code used in this vignette is <a href="https://github.com/CenterForAssessment/NCME_2022_Training_Session/tree/main/Documents/vignettes/Missing_Data_Multiple_Imputation">available on Github</a> and the following <code>R</code> packages will be required to re-create the results:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Data and data management</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(SGPdata)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(data.table)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    Missing data simulation, imputation and visualization</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(VIM)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(mice)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(miceadds)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    Parametric imputed data analysis</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(lme4)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(merTools)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    Point estimate data analysis and visualization</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(SGP)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(gghighlight)</span></code></pre></div>
<p>Before getting into data simulation and analysis, however, we provide a brief introduction to potential problems missing data poses for statistical analysis and interpretation of student achievement and growth. Resources we have found useful are also provided.</p>
</div>
<div id="the-missing-data-problem" class="section level1 hasAnchor">
<h1 class="hasAnchor">
<a href="#the-missing-data-problem" class="anchor" aria-hidden="true"></a>The Missing Data Problem<a href="#the-missing-data-problem" class="anchor-section" aria-label="Anchor link to header"></a>
</h1>
<p>The issues missing data presents to the analysis, interpretation and reporting of partially observed data are manifold: biased parameter estimates, unrepresentative samples, complication of analytic methods and procedures, and reduced power in statistical tests. Nearly all standard statistical methods assume perfect and complete variables are used, yet even a few unobserved data points can be problematic.</p>
<p>Over the past two decades, researchers in education have benefited from the revolving door of state and federal accountability policies that required census student assessment. As a result, missing data problems, and potential solutions, had received little attention in our field. The luxury of ignoring missing data and student participation rates came to an abrupt end at the onset of the COVID-19 pandemic, and the need to consider the problematic nature of the data will persist into the foreseeable future as we try to gauge the full impact of the pandemic and the nature of student learning recovery. To date the missing data problem in state-level education is two fold: the (nearly) universal absence of data in 2020 after state assessment administrations were cancelled, and the varied levels of student participation (both within and between states).</p>
<p>The absence of 2020 data has required universal approaches to data analysis in 2021; namely ignoring this gap in longitudinal analyses (e.g., skip-year student growth). The varied and complex nature of student participation in 2021, although not as extensive, complicates the 2021 analyses and investigations of pandemic impact and will require on-going attention as recovery is monitored and accountability requirements are re-instituted.</p>
<p>Currently some general points to consider are:</p>
<ul>
<li>Low participation does not impact the ability to calculate measures of student growth or pandemic impact (e.g., cohort referenced growth norms nor use of baseline referenced growth norms).
<ul>
<li>Point estimates and confidence intervals may be biased, but we are not prevented from making those calculations.</li>
</ul>
</li>
<li>Low participation does impact comparisons of group level results with historical (e.g.,
<ol start="2019" style="list-style-type: decimal">
<li>results based upon higher participation rates.</li>
</ol>
<ul>
<li>For example, how should one compare growth and status results for schools in 2019 and 2021 with very different rates of participation.</li>
<li>Have low rates of participation affected the comparability of student groups and populations of interest (demographic subgroups, schools/districts, etc.)? Are these sub-populations fundamentally different now than they were in previous years or not fully representative due to observed patterns of non-participation?</li>
</ul>
</li>
<li>Low participation will continue to impact the ability to monitor student recovery, appropriate educational resources where most needed and make complete, accurate and fair accountability decisions for teachers, schools, districts, etc. going forward.</li>
</ul>
<div id="the-case-for-multiple-imputation-methods" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#the-case-for-multiple-imputation-methods" class="anchor" aria-hidden="true"></a>The case for multiple imputation methods<a href="#the-case-for-multiple-imputation-methods" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>After the cancellation of spring statewide testing in March and April of 2020 we began working with states to investigate the feasibility of calculating student growth despite the 2020 data gap (i.e. skip-year student growth percentiles). Over 2020 we conducted analyses tailored to each states’ context using historical data, coming to the conclusion that skip-year growth calculations were good approximations to those obtained from full calculations. When it became clear that we would need additional tools to address low participation, we considered several alternatives and options to augment the analysis of the observed, imperfect, data (“pairwise deletion” of missing data). Ultimately multiple imputation (MI) was chosen over other alternatives such as maximum likelihood regression approaches or propensity score weighting/matching (although the latter can be used in tandem with MI). The reasons for this choice include:</p>
<ul>
<li>Rather than substituting a single value for each missing data point, multiple plausible values are generated using the observed data (including its variability and uncertainty).</li>
<li>It includes estimates uncertainty due to the missing data (variability between imputed data sets) to give more realistic confidence intervals.</li>
<li>MI has been used extensively in other fields of research and has been shown to produce valid statistical inference and has a well developed set an analytic tools available on <code>R</code> and other software platforms.</li>
</ul>
</div>
</div>
<div id="simulating-missing-data" class="section level1 hasAnchor">
<h1 class="hasAnchor">
<a href="#simulating-missing-data" class="anchor" aria-hidden="true"></a>Simulating Missing Data<a href="#simulating-missing-data" class="anchor-section" aria-label="Anchor link to header"></a>
</h1>
<p>Using data simulations is a useful tool for recognizing and anticipating missing data patterns, preparing for potential problems that might occur and understanding the utility and limitations of certain statistical methods. By starting with a complete simulated data set, removing cases systematically and then performing statistical analyses (MI and subsequent analyses of interest), one can compare the “true” results to those from the missing/observed and imputed data. This section of the training will deal with taking a complete data set and generating missing data patterns similar to those observed in some states in 2021. In the subsequent section we take this data and apply MI in an attempt to reconstruct the complete data structure before comparing several post-imputation analyses using the data in all three states of completion.</p>
<div id="data-retrieval-and-working-directory-setup" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#data-retrieval-and-working-directory-setup" class="anchor" aria-hidden="true"></a>Data retrieval and working directory setup<a href="#data-retrieval-and-working-directory-setup" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>For this part of the training we will use the <code>sgpData_LONG_COVID</code> object from the <code>SGPdata</code> package, which contains simulated data from 2016 to 2023. The data follows the same format as the example <a href="https://sgp.io/articles/SGP_Data_Preparation.html#long-data-format-sgpdata_long">long data</a> from the <code>SGP</code> package. It includes 7 years of annual assessment data in two content areas (ELA and Mathematics) and is missing 2020 data to help users model COVID related interruptions to student status and growth. The data comes with a “built-in” impact in 2021 related to the pandemic (although an unperturbed version - <code>"SCALE_SCORE_without_COVID_IMPACT"</code> is also available so that different impact scenarios can be modeled).</p>
<p>This data set contains only “complete” records for students in the longitudinal form in that there are no <code>NA</code> values in any variable. However, as will be discussed below, there are students who repeat grades levels, drop out of the system, have records with gaps between years, etc. In this regard the data does include missing records, particularly for analyses conducted on cross-sectional (wide) data.</p>
<p>A subset of <code>sgpData_LONG_COVID</code> restricted to the 2021 7<sup>th</sup> grade ELA cohort is used throughout this vignette. Our interest in this data will be to take a complete subset of the data and create missing data patterns only in the student score variables. No demographic, school/district identifiers, etc. will be made missing. These would be similar situations we have dealt with in which students are known to be enrolled in a school, but were not tested for any number of reasons (illness, refusal, school context etc.). This information is critical in being able to later use imputed data to estimate school and sub-group level impact of the COVID pandemic.</p>
<p>The following code defines the cohort of interest, retrieves and subsets the data, and returns it in a wide format<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. A new variable is also created in this step - a standardized scale score (<code>Z_SCORE</code>), which is standardized using 2019 as a reference year for all years.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    Define the cohort of interest</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cohort.grades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"7"</span>) <span class="co"># All `classes` must match - GRADE and YEAR are characters.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>content.areas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"ELA"</span>, <span class="dv">3</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>cohort.years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2021"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>current.year <span class="ot">&lt;-</span> <span class="fu">tail</span>(cohort.years, <span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">###   Data retrieval</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Demonstration_COVID_Data <span class="ot">&lt;-</span> SGPdata<span class="sc">::</span>sgpData_LONG_COVID</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/Data_Retrieval_Initial.R"</span>, <span class="at">local =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    Returns several data objects, but `wide_data` is the main one we'll use.</span></span></code></pre></div>
<p>Inspecting the <code>wide_data</code> object returned from this reveals that missing data is already present even though all cases in the original <code>sgpData_LONG_COVID</code> object are complete. The conversion from long to wide data reveals the presence of students who have disappeared from the system, repeated a grade, etc. and now show up as missing records in some years. This is a valuable lesson that even when data may be presented as “complete”, that assumption may not hold in all contexts.</p>
<p>In order to start with complete data for this exercise, we will remove any rows with missing scores.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> wide_data[<span class="sc">!</span>(<span class="fu">is.na</span>(Z_SCORE<span class="fl">.2018</span>) <span class="sc">|</span> <span class="fu">is.na</span>(Z_SCORE<span class="fl">.2019</span>) <span class="sc">|</span> <span class="fu">is.na</span>(Z_SCORE<span class="fl">.2021</span>)),]</span></code></pre></div>
<p>If we compare the number of rows in <code>wide_data</code> before and after this filter, we see that around 32% of the data is now removed. We will use that as a rough target for added missingness going forward.</p>
</div>
<div id="the-ampute-function" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#the-ampute-function" class="anchor" aria-hidden="true"></a>The <code>ampute</code> function<a href="#the-ampute-function" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>The <code>mice::ampute</code> function was developed to provide a systematic process for simulating missing data. A user can specify a number of parameters including the proportion, patterns and factors (observed variables) that contribute to missing data. The author of this function, Rianne Schouten, provides an excellent vignette <a href="https://rianneschouten.github.io/mice_ampute/vignette/ampute.html#missingness_proportion_per_variable">online.</a></p>
<p>We will generate missing data based solely on prior achievement at the student and school aggregate levels. Demographic and other variables could also be factored in as desired. For example, if it is assumed that students in urban areas may be more likely to be missing, school size could be included as a proxy for this.</p>
<p>As a first step, we take a subset of the achievement variables from the <code>wide_data</code> object and create a school aggregate to use with the <code>ampute</code> function to simplify the following steps.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    The variable base (long) names that will be factored into missing data patterns</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ampute.factors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SCHOOL_NUMBER"</span>, <span class="st">"Z_SCORE"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Select the subset of relevant variables from `wide_data`</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>amp.vars <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="fu">paste</span>(ampute.factors, <span class="at">collapse=</span><span class="st">"|"</span>), <span class="fu">names</span>(wide_data))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ampute_subset <span class="ot">&lt;-</span> wide_data[, ..amp.vars]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    Summarize 2021 students' prior (2019) scores for their 2021 schools</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>ampute_subset[, MEAN_PRIOR_Z <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(Z_SCORE<span class="fl">.2019</span>), by <span class="ot">=</span> <span class="st">"SCHOOL_NUMBER"</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>ampute_subset[, <span class="fu">grep</span>(<span class="st">"SCHOOL_NUMBER"</span>, <span class="fu">names</span>(ampute_subset)) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code></pre></div>
<div id="using-ampute-funtion-defaults" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#using-ampute-funtion-defaults" class="anchor" aria-hidden="true"></a>Using <code>ampute</code> funtion defaults<a href="#using-ampute-funtion-defaults" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>To illustrate an <code>ampute</code> function use case we begin by feeding the data and examining the results “out-of-the-box” using the defaults.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    Run `ampute` out-of-the-box and explore results</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>test.result <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">ampute</span>(ampute_subset)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(test.result<span class="sc">$</span>amp, <span class="at">rotate.names =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/basic_ampute-1.svg" width="466.666666666667" style="display: block; margin: auto;"></p>
<pre><code>##      Z_SCORE.2018 Z_SCORE.2019 Z_SCORE.2021 MEAN_PRIOR_Z     
## 3081            1            1            1            1    0
## 842             1            1            1            0    1
## 813             1            1            0            1    1
## 806             1            0            1            1    1
## 799             0            1            1            1    1
##               799          806          813          842 3260</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>test.result<span class="sc">$</span>prop</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>test.result<span class="sc">$</span>patterns</span></code></pre></div>
<pre><code>##   Z_SCORE.2018 Z_SCORE.2019 Z_SCORE.2021 MEAN_PRIOR_Z
## 1            0            1            1            1
## 2            1            0            1            1
## 3            1            1            0            1
## 4            1            1            1            0</code></pre>
<p>There are several things to note about the data amputation results here. The default proportion of missing cases (<code>prop = 0.5</code>) is higher than what we want to replicate (~<code>0.325</code>). In the <code>md.pattern</code> plot we see that the default missing patterns (red squares indicate missing cases are present) include the aggregate school measures we created. This makes no sense in our context - we only want missing values in the student-level variables. Also, there are only patterns in which one variable is missing per row, where we would actually like to see patterns where students may be missing multiple years of data (for example, only having data for 2021).</p>
</div>
<div id="missing-data-patterns" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#missing-data-patterns" class="anchor" aria-hidden="true"></a>Missing data patterns<a href="#missing-data-patterns" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>To customize the patterns that are included, we will supply a customized <code>data.frame</code> to the <code>patterns</code> argument. We will also specify the proportion of missing values we want to achieve (overall) in the data.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>my.patterns <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Some we want from the default</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),  <span class="co">#  only missing 2018</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),  <span class="co">#  only missing 2019</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),  <span class="co">#  only missing 2021</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Some we want to add to default</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),  <span class="co">#  missing 2018 &amp; 2019 (only 2021 score)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),  <span class="co">#  missing 2018 &amp; 2021</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)   <span class="co">#  missing 2019 &amp; 2021</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                ), <span class="at">nrow =</span> <span class="dv">4</span>)))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>test.result <span class="ot">&lt;-</span> <span class="fu">ampute</span>(ampute_subset, <span class="at">prop =</span> <span class="fl">0.325</span>, <span class="at">patterns =</span> my.patterns)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(test.result<span class="sc">$</span>amp, <span class="at">rotate.names =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/ampute_patterns-1.svg" width="466.666666666667" style="display: block; margin: auto;"></p>
<pre><code>##      MEAN_PRIOR_Z Z_SCORE.2018 Z_SCORE.2021 Z_SCORE.2019     
## 4288            1            1            1            1    0
## 339             1            1            1            0    1
## 319             1            1            0            1    1
## 372             1            1            0            0    2
## 339             1            0            1            1    1
## 341             1            0            1            0    2
## 343             1            0            0            1    2
##                 0         1023         1034         1052 3109</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>test.result<span class="sc">$</span>prop</span></code></pre></div>
<pre><code>## [1] 0.325</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>test.result<span class="sc">$</span>freq</span></code></pre></div>
<pre><code>## [1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667</code></pre>
</div>
<div id="frequency-of-patterns" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#frequency-of-patterns" class="anchor" aria-hidden="true"></a>Frequency of patterns<a href="#frequency-of-patterns" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>The plot produced now shows that we have more interesting patterns of missing data. However, if we look at the bottom row of numbers, we see that the frequency of missing data is roughly equal for each variable. The output from <code>test.result$freq</code> shows that each pattern is missing at the same rate, which does not match what we want to simulate pre-pandemic or in 2021.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>my.freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>,   <span class="co">#  only missing 2018 - fairly common previously</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.05</span>,  <span class="co">#  only missing 2019 - less common</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.50</span>,  <span class="co">#  only missing 2021 - most likely</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.1</span>,   <span class="co">#  only 2021 scores  - students new to the system</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.175</span>, <span class="co">#  only 2019 scores  - fairly common</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.075</span>  <span class="co">#  only 2018 scores  - less common, but still occurs</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            )   <span class="co">#   frequencies must sum to 1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>test.result <span class="ot">&lt;-</span> <span class="fu">ampute</span>(ampute_subset, <span class="at">prop =</span> <span class="fl">0.3</span>, <span class="at">patterns =</span> my.patterns, <span class="at">freq =</span> my.freq)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(test.result<span class="sc">$</span>amp, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##      MEAN_PRIOR_Z Z_SCORE.2019 Z_SCORE.2018 Z_SCORE.2021     
## 4372            1            1            1            1    0
## 993             1            1            1            0    1
## 199             1            1            0            1    1
## 342             1            1            0            0    2
## 102             1            0            1            1    1
## 146             1            0            1            0    2
## 187             1            0            0            1    2
##                 0          435          728         1481 2644</code></pre>
</div>
<div id="weighting-of-factors-related-to-missing-data-patterns" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#weighting-of-factors-related-to-missing-data-patterns" class="anchor" aria-hidden="true"></a>Weighting of factors related to missing data patterns<a href="#weighting-of-factors-related-to-missing-data-patterns" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>For the final step in producing interesting patterns of missing data, we will provide a custom matrix of factor weights. For example, here we will simulate missingness that is correlated with (low) achievement and also assume that these factors are compounded by the school level concentration of low achievement.</p>
<p>The default weight matrix is identical to the pattern matrix, so the first row of the weight matrix corresponds to the pattern specified in the first row of the pattern matrix. Here a <code>0</code> means a variable contributes nothing to the missing data pattern. Weights are relative and can be either integers or values between 0 and 1. For example one can use <code>c(4, 1)</code> to specify that the first variable contributes 4 times as much weight as the second, or use <code>c(1, 0.25)</code> for the same effect.</p>
<p>The weight matrix below allows us to produce missing data that includes a variety of factors and weights ranging from “missing completely at random” (MCAR) to “missing at random” (MAR) and “missing not at random” (MNAR, i.e. missing cases depend on the unobserved values of the variable in question rather than other variables observed in the data). Weights can also be positive or negative. Positive values mean that variables with a higher weighted sum-score have a higher probability of being made missing and vice-versa. In this example, we want lower achieving students/schools to have a higher probability of being amputed, so we will multiply the matrix by <code>-1</code> - making all but one value negative in the final weight matrix.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>my.weights <span class="ot">&lt;-</span> test.result<span class="sc">$</span>weights</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>my.weights[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)     <span class="co">#  MCAR - missing completely at random</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>my.weights[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)     <span class="co">#  MCAR - missing completely at random</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>my.weights[<span class="dv">3</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.25</span>, <span class="dv">1</span>)  <span class="co">#  MAR/MNAR - missing at random and weakly related to the observed score itself</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>my.weights[<span class="dv">4</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>)  <span class="co">#  MAR - students show up in system at best schools</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>my.weights[<span class="dv">5</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="dv">1</span>)  <span class="co">#  MAR/MNAR</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>my.weights[<span class="dv">6</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.25</span>, <span class="dv">1</span>)  <span class="co">#  MAR/MNAR</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    reverse weight - lower scoring kids more likely to be missing</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>my.weights <span class="ot">&lt;-</span> my.weights <span class="sc">*</span> <span class="sc">-</span>1L</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>test.result <span class="ot">&lt;-</span> <span class="fu">ampute</span>(ampute_subset, <span class="at">prop =</span> <span class="fl">0.325</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">patterns =</span> my.patterns,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">freq =</span> my.freq,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> my.weights)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(test.result<span class="sc">$</span>amp, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##      MEAN_PRIOR_Z Z_SCORE.2019 Z_SCORE.2018 Z_SCORE.2021     
## 4204            1            1            1            1    0
## 1080            1            1            1            0    1
## 194             1            1            0            1    1
## 368             1            1            0            0    2
## 91              1            0            1            1    1
## 180             1            0            1            0    2
## 224             1            0            0            1    2
##                 0          495          786         1628 2909</code></pre>
<p>In addition to the <code>md.pattern</code> plot we can look at box plots available from <code>mice::bwplot</code> to insure that the data distributions by pattern meet our expectations.</p>
<pre><code>## $`Boxplot pattern 2`</code></pre>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/ampute_boxplots-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<pre><code>## $`Boxplot pattern 3`</code></pre>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/ampute_boxplots-2.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<pre><code>## $`Boxplot pattern 5`</code></pre>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/ampute_boxplots-3.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<p>With the <code>prop</code>, <code>patterns</code>, <code>freq</code> and <code>weights</code> arguments customized, this will serve as our final missing data model. We will now merge the amputed student level variables into the <code>wide_data</code> object (first renaming and conserving the complete variables).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Merge amputed scores and reserve/rename the complete scores</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>amp_scores <span class="ot">&lt;-</span> <span class="fu">data.table</span>(test.result<span class="sc">$</span>amp[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(wide_data, <span class="fu">names</span>(amp_scores), <span class="fu">gsub</span>(<span class="st">"Z_SCORE"</span>, <span class="st">"COMPLETE_Z"</span>, <span class="fu">names</span>(amp_scores)))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(wide_data, amp_scores)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">na.omit</span>(wide_data))<span class="sc">/</span><span class="fu">nrow</span>(wide_data); <span class="dv">6341</span><span class="sc">/</span><span class="dv">9377</span> <span class="co">#  +32% overall missing proportion</span></span></code></pre></div>
<pre><code>## [1] 0.6629869</code></pre>
<pre><code>## [1] 0.6762291</code></pre>
</div>
</div>
<div id="missing-data-explorationvisualization" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#missing-data-explorationvisualization" class="anchor" aria-hidden="true"></a>Missing data exploration/visualization<a href="#missing-data-explorationvisualization" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>With a promising set of amputed data, we can further evaluate it to make sure it looks like what we wanted. In our assumptions, we expect to see more missing data for students with lower 2019 scale scores. The following visualizations from the <code>VIM</code> package are helpful in exploring missing data relationships. See the VIM package for more context on these plots. In general, blue means observed data, red means missing. A good introduction is given <a href="https://www.datacamp.com/community/tutorials/visualize-data-vim-package">here</a>.</p>
<p>The first <code>VIM</code> plot produced is a set of histograms that compares missing data patterns in 2018 to 2019 with those from 2019 to 2021. Here we see that we have been (quite!) successful in introducing a relationship between prior achievement and missingness. The 2019 missing cases are more-or-less randomly distributed given 2018 observed scores, but the 2021 missing case distribution is heavily concentrated in lower prior score observations.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Missing data visualizations with VIM</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2019</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(<span class="fu">as.data.frame</span>(wide_data[, <span class="fu">c</span>(<span class="st">"Z_SCORE.2018"</span>, <span class="st">"Z_SCORE.2019"</span>)]),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"Missing 2019 to 2018"</span>, <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>, <span class="at">only.miss=</span><span class="cn">FALSE</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/vim_hists-1.svg" width="466.666666666667" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2021</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(<span class="fu">as.data.frame</span>(wide_data[, <span class="fu">c</span>(<span class="st">"Z_SCORE.2019"</span>, <span class="st">"Z_SCORE.2021"</span>)]),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"Missing 2021 to 2019"</span>, <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>, <span class="at">only.miss=</span><span class="cn">FALSE</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/vim_hists-2.svg" width="466.666666666667" style="display: block; margin: auto;"></p>
<p>We can also create mosaic plots that provide interesting comparisons of missing data by multiple demographic characteristics. For example, we can look at missingness by ethnicity and economic status (as indicated by free/reduced lunch qualification).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicMiss</span>(<span class="fu">as.data.frame</span>(<span class="fu">droplevels</span>(wide_data[, <span class="fu">c</span>(<span class="st">"ETHN"</span>, <span class="st">"FRL"</span>, <span class="st">"Z_SCORE.2021"</span>)])),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">highlight =</span> <span class="dv">3</span>, <span class="at">plotvars =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">miss.labels =</span> <span class="cn">FALSE</span>, <span class="at">only.miss=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/vim_mosaic-1.svg" width="466.666666666667" style="display: block; margin: auto;"></p>
<p>Based on this visualization, we might conclude that a relationship exists between FRL status and missing data. We know from the <code>ampute</code> specification that FRL status was not factored in, and that the relationship shown here is actually indicative of an effect of FRL status on achievement.</p>
<p>We can look at the amputed data relative to what we know to be “true”. Even though we specified a weak MNAR missing pattern, we see that missingness is highly correlated with unobserved (current) score because we have used prior scores to determine the probability of being missing. Given their high correlation, this plays out in the amputed data as well.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histMiss</span>(<span class="fu">as.data.frame</span>(wide_data[, <span class="fu">c</span>(<span class="st">"COMPLETE_Z.2021"</span>, <span class="st">"Z_SCORE.2021"</span>)]),</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"2021 Missing by 2021 Complete"</span>, <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">interactive=</span><span class="cn">FALSE</span>, <span class="at">only.miss=</span><span class="cn">FALSE</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/VIM_comp_v_amp-1.svg" width="466.666666666667" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="multiple-imputation" class="section level1 hasAnchor">
<h1 class="hasAnchor">
<a href="#multiple-imputation" class="anchor" aria-hidden="true"></a>Multiple Imputation<a href="#multiple-imputation" class="anchor-section" aria-label="Anchor link to header"></a>
</h1>
<p>Multiple imputation (MI) is a simulation-based procedure. Its purpose is not to re-create the (true) individual missing values, but to achieve valid statistical inference in the presence of missing data (Schafer, 1997). MI methods use information from the observed data to generate a set of plausible values for the missing observations in the data. This procedure is repeated many times to account for sampling error that arises when generating these values, and model parameters are pooled across the imputed data sets (Enders, 2010; Fox &amp; Weisberg, 2018). As Fox and Weisberg (2018) write, MI “takes into account not only uncertainty due to residual variation - that is, the inability to predict missing values without error from the observed data (e.g., by sampling from the estimated error distribution for a continuous variable or sampling from the estimated conditional probability distribution of a factor) - but also uncertainty in the parameter estimates used to obtain the predictions (by sampling from the estimated distribution of the parameters of the imputation model)” (p. 3).</p>
<p>There are numerous MI methods available, largely differentiated by the model used to generate the imputed values. MI methods can be broadly grouped into those that use joint modeling (JM) or fully conditional specification (FCS). JM assumes that the data come from a multivariate distribution and imputations are drawn from a fitted distribution (typically multivariate normal). FCS, also known as MI with chained equations (MICE), is a semi-parametric approach that imputes multivariate missing data one variable at a time in an iterative fashion for each incomplete variable. It is parametric in that each variable can potentially have a different imputation model with a set of predictors that explain the missing data. It is non-parametric in that the form (e.g. linear) of the imputation model is specified depending on the type of variable (binary, count, ordinal, continuous, etc.). Trade offs between the two types include better theoretical underpinnings in JM and flexibility while preserving unique features of the data with FCS (Van Buuren, 2018).</p>
<div id="the-three-steps-of-multiple-imputation" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#the-three-steps-of-multiple-imputation" class="anchor" aria-hidden="true"></a>The three steps of multiple imputation<a href="#the-three-steps-of-multiple-imputation" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>Regardless of the chosen algorithm(s) or modeling approach, the typical MI workflow can be reduced to three steps in which information from the observed data is used to generate parameter estimates:</p>
<ul>
<li>
<strong><em>Imputation:</em></strong> A prediction model generates a set of plausible values for the missing observations, resulting in <code>M</code> imputed data sets.</li>
<li>
<strong><em>Analysis:</em></strong> The analysis (e.g., baseline SGPs) is conducted on each of the <code>M</code> data sets.</li>
<li>
<strong><em>Pooling:</em></strong> Parameter and (perhaps more importantly) uncertainty estimates are constructed by pooling across the <code>M</code> analyses.</li>
</ul>
<p>The figure below (Figure 5.1 in Van Buuren, 2018) provides a nice visual synopsis of the MI workflow.</p>
<p><img src="ch01-miflow-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>In the context of learning loss analyses, we have used MI to estimate mean scale score and baseline SGP values to draw comparisons between pre- and post-pandemic test results. Notably, such comparisons are not aimed at accountability initiatives, but rather to provide states, districts and schools with a better understanding of how student learning was impacted. Such information can inform how states, districts and schools can better support students moving forward by assessing their recovery.</p>
<div id="choosing-an-imputation-strategy-for-step-1" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#choosing-an-imputation-strategy-for-step-1" class="anchor" aria-hidden="true"></a>Choosing an imputation strategy for Step 1<a href="#choosing-an-imputation-strategy-for-step-1" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>In the simulation studies and MI method vetting process the Center for Assessment conducted in late spring 2021, at least eight MI algorithms were applied and compared. These included:</p>
<ul>
<li>One-level predictive mean matching (<code>mice::mice.impute.pmm</code>)</li>
<li>Multi-level modeling with predictive mean matching (<code>miceadds::mice.impute.2l.pmm</code>)</li>
<li>Cross-sectional multi-level modeling with pan (<code>mice::mice.impute.2l.pan</code>)</li>
<li>Cross-sectional multi-level modeling with the lmer function (<code>mice::mice.impute.2l.lmer</code>)</li>
<li>Longitudinal multi-level modeling with pan (<code>mice::mice.impute.2l.pan</code>)</li>
<li>Longitudinal multi-level modeling with lmer (<code>mice::mice.impute.2l.lmer</code>);</li>
<li>Quantile regression (<code>Qtools::mice.impute.rrq</code>)</li>
<li>Random forests (<code>mice::mice.impute.rf</code>)</li>
</ul>
<p>These simulation studies were summarized and documented meticulously by the Center’s 2021 intern, Allie Cooperman, and are available on her <a href="https://centerforassessment.github.io/Internship_2021/articles/MI_Vignette_Landing_Page.html">internship website.</a></p>
<p>Overall, the cross-sectional modeling with pan demonstrated the best performance among the examined methods. Specifically, it was most often able to maintain average percent bias for school level aggregates for achievement (mean scale scores) and growth (mean baseline SGPs) below 5%, while simultaneously constructing confidence intervals with higher coverage rates. Additionally, it most often failed to reject the null hypothesis that the imputed and true values are equivalent. In other words, the other MI methods more often found statistically significant differences (using the simplified F1 statistic of Vink and Van Buuren, 2014) between the imputed and true average achievement and growth values. Finally, it was the only method found to be negatively related to scale score bias, suggesting reduced scale score bias compared to the “observed” condition.</p>
<p>Although this modeling choice worked well for our needs, it is important to stress that these choices will depend on, and should be driven by, the specific contexts of the data and the statistical model(s) to be used in the analysis step of the workflow. There is no “one-size-fits-all” solution.</p>
<p>In the following sections we again re-create steps taken in our initial investigations in the spring of 2021 to evaluate a few of the available MI methods.</p>
</div>
</div>
<div id="multiple-imputation-with-simulated-missing-data" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#multiple-imputation-with-simulated-missing-data" class="anchor" aria-hidden="true"></a>Multiple imputation with simulated missing data<a href="#multiple-imputation-with-simulated-missing-data" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>Continuing where we left off with the simulation of missing data, we will first select the factors we want to include in our imputation model(s). We will feign ignorance of the underlying missing data generating process for now and specify the use of student level achievement, FRL status as well as school level aggregates of these factors. Again, the only variables with missing data in them are the student level (standardized) scale scores, so these will be the only variables being imputed. These would be similar to students who were known to be enrolled in a school, but were not tested.</p>
<p>Note we are also keeping our complete (“true”) score values in this subset. These will NOT be used for imputation (cheating!), but we want to keep them in our data set for subsequent analyses. This can be done for any number of variables of interest (e.g., demographics, indicators of mode of instruction, etc.), but they must be given special attention to ensure they are/not used as imputation predictors as desired.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>impute.factors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SCHOOL_NUMBER"</span>, <span class="st">"Z_SCORE"</span>, <span class="st">"FRL"</span>) <span class="co"># paste(c("ID", "COMPLETE_Z", impute.factors), collapse="|")</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="do">###   Select subset of `wide_data` that will be used for imputation and/or subsequent analyses</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>impute.vars <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^ID$|COMPLETE_Z|Z_SCORE|SCHOOL_NUMBER|FRL"</span>, <span class="fu">names</span>(wide_data))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>impute_subset <span class="ot">&lt;-</span> wide_data[, ..impute.vars]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(impute_subset, <span class="fu">gsub</span>(<span class="fu">paste0</span>(<span class="st">"."</span>, current.year), <span class="st">""</span>, <span class="fu">names</span>(impute_subset)))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="do">###   Create institutional level averages of achievement and economic disadvantage</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>impute_subset[, MEAN_INST_PRIOR_SCORE <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(Z_SCORE<span class="fl">.2019</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), by <span class="ot">=</span> <span class="st">"SCHOOL_NUMBER"</span>] <span class="co">#</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>impute_subset[, PERCENT_INST_FRL <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(FRL, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), by <span class="ot">=</span> <span class="st">"SCHOOL_NUMBER"</span>]</span></code></pre></div>
<p>Next we will define a few key parameters for the MI process. These include the number of imputed data sets we want (<code>M</code>), the number of iterations we will allow for each imputation (<code>MAXIT</code>) to converge on an answer and the imputation algorithm (<code>impute.method</code>). We also produce default <code>method</code> and <code>predictorMatrix</code> objects for those arguments.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Specify imputation parameters for `mice::mice`</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>MAXIT <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>impute.method <span class="ot">&lt;-</span> <span class="st">"pmm"</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>my.methods <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">make.method</span>(<span class="at">data=</span>impute_subset)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>my.predMtrx <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">make.predictorMatrix</span>(<span class="at">data=</span>impute_subset)</span></code></pre></div>
<p>We will modify the assignment of <code>method</code> and predictors to ensure that we are using our chosen imputation methods and prediction factors. Here we assign the score variables the <code>impute.method</code> of choice (redundant here as <code>pmm</code> is the default in <code>mice</code> for most variable types) and prevent ID and the complete scores from being either predicted or used in any predictions. Note that only variables with missing data will be assigned a <code>method</code> from and all variables are used to predict others by default in <code>make.method</code> and <code>make.predictorMatrix</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>my.methods[<span class="fu">grep</span>(<span class="st">"^Z_SCORE"</span>, <span class="fu">names</span>(my.methods))] <span class="ot">&lt;-</span> impute.method</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="st">"ID"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="st">"SCHOOL_NUMBER"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="fu">grep</span>(<span class="st">"COMPLETE_Z"</span>, <span class="fu">rownames</span>(my.predMtrx))] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># i.e. "Nothing used to predict it" -- redundant my.methods["COMPLETE_Z"] == ""</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="fu">grep</span>(<span class="st">"COMPLETE_Z"</span>, <span class="fu">rownames</span>(my.predMtrx)), ] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># i.e. "It's used to predict nothing"</span></span></code></pre></div>
<p>We will also use schools as a (categorical) predictor of the missing student scores.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>impute_subset[, SCHOOL_NUMBER <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(SCHOOL_NUMBER)]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="st">"SCHOOL_NUMBER"</span>, <span class="fu">grep</span>(<span class="st">"^Z_SCORE"</span>, <span class="fu">names</span>(my.methods))] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div id="step-1---data-imputation" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#step-1---data-imputation" class="anchor" aria-hidden="true"></a>Step 1 - data imputation<a href="#step-1---data-imputation" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>We are now ready to create our first set of imputed data.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>imputed_results <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(<span class="at">data =</span> impute_subset,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> my.methods,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predictorMatrix =</span> my.predMtrx,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">m =</span> M, <span class="at">maxit =</span> MAXIT, <span class="at">seed =</span> 719589L, <span class="at">print =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>That was fast! We should look at a few diagnostic plots to assess how the process went. This first plot looks at the convergence of the <code>M</code> imputations over the <code>MAXIT</code> iterations.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imputed_results)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_converge-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<p>The second plot looks at the distribution densities of the <code>M</code> imputations (in red) compared to the observed distribution (blue) for each of the imputed variables.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(imputed_results)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_dense-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<p>The final diagnostic plot is a custom set of scatter plots that allow us to compare the bivariate distribution of the complete, imputed and observed data (top to bottom). Plots in the left column are the prior years (2018 and 2019) and those on the right are for 2019 and 2021.</p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_scat-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
</div>
<div id="step-23---imputation-analysis-and-results-pooling" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#step-23---imputation-analysis-and-results-pooling" class="anchor" aria-hidden="true"></a>Step 2/3 - imputation analysis and results pooling<a href="#step-23---imputation-analysis-and-results-pooling" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>We will now conduct <code>M</code> sets of analyses and one set of pooled results for the imputed data. We also run identical analyses using both the complete and observed data. We proceed by first collecting the imputations into a <code>list</code> object and converting each of those as well as the <code>wide_data</code> back into longitudinal form.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Collect all imputation results in a list length = M</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> miceadds<span class="sc">::</span><span class="fu">mids2datlist</span>(imputed_results)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="do">###   Convert data (complete, missing, and imputed) to long format</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/Data_Retrieval_for_Analysis.R"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    Returns objects `long_complete`, `long_amputed` and `res_long`</span></span></code></pre></div>
<div id="linear-mixed-effects-model" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#linear-mixed-effects-model" class="anchor" aria-hidden="true"></a>Linear mixed effects model<a href="#linear-mixed-effects-model" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>The first post-imputation analysis we will run is a linear mixed effects model. This has been selected because it is a fairly interesting, and popular, model for analyzing longitudinal data for students nested within schools. It also provides us with results that have well documented and operationalized procedures for pooling results. Specifically, in this exercise we submit that the parameter of interest is a fixed effect estimate for COVID impact. We can easily get a pooled estimate of this parameter along with standard errors and t values.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>frmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"Z_SCORE ~ YEAR + COVID_IMPACT*FRL + (COVID_IMPACT | SCHOOL_NUMBER/ID)"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>lmer.ctl <span class="ot">&lt;-</span> <span class="fu">lmerControl</span>(<span class="at">check.conv.grad =</span> <span class="fu">.makeCC</span>(<span class="st">"warning"</span>, <span class="fl">0.02</span>, <span class="cn">NULL</span>))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>true_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> frmla, <span class="at">data =</span> long_complete, <span class="at">control =</span> lmer.ctl)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>miss_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> frmla, <span class="at">data =</span> long_amputed, <span class="at">control =</span> lmer.ctl)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>imp_mods <span class="ot">&lt;-</span> <span class="fu">lmerModList</span>(<span class="at">formula=</span>frmla, <span class="at">data =</span> res_long, <span class="at">control =</span> lmer.ctl)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="do">###   Collate and print model (fixed effects) estimate comparison</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/MI_LME_Model_Comp.R"</span>)</span></code></pre></div>
<pre><code>## 
## 
##                    |         ESTIMATE         |         STD ERR         |
##      Fixed Effects | -------  ------- ------- | ------- ------- ------- |
##       Coefficients |   True   Missing Imputed |   True  Missing Imputed |
##  ----------------- | -------  ------- ------- | ------- ------- ------- |
##        (Intercept) |  -56.67   -58.77   -59.7 |    15.2   16.69   35.64 |
##       COVID_IMPACT |   -0.19    -0.18   -0.19 |    0.03    0.03    0.03 |
##   COVID_IMPACT:FRL |    0.02     0.03    0.03 |    0.02    0.02    0.02 |
##                FRL |   -0.42    -0.42   -0.42 |    0.02    0.02    0.02 |
##               YEAR |    0.03     0.03    0.03 |    0.01    0.01    0.01 |
##          t VALUE         |
##  ------- ------- ------- |
##    True  Missing Imputed |
##  ------- ------- ------- |
##    -3.73   -3.52   -1.68 |
##     -6.2    -5.7   -6.67 |
##     1.25    1.83    1.81 |
##   -17.61  -17.57  -17.83 |
##     3.74    3.53     3.9 |</code></pre>
</div>
<div id="baseline-student-growth-percentiles" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#baseline-student-growth-percentiles" class="anchor" aria-hidden="true"></a>Baseline student growth percentiles<a href="#baseline-student-growth-percentiles" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<p>Student growth percentiles, being quantities associated with each individual student, can be easily summarized across numerous grouping indicators to provide summary results regarding growth. <strong><em>Cohort</em></strong> referenced percentiles, being annually normed across all students in the state, the median of all student growth percentiles in any grade is 50 when we have perfect data fit. The median of a collection of growth percentiles is used as the measure of central tendency to summarize the distribution as a single number. Median growth percentiles well below 50 represent growth less than the state “average” and median growth percentiles well above 50 represent growth in excess of the state “average”.</p>
<p>It is important to note how, at the entire state level, the <em>normative</em> growth information returns very little information. What the results indicate is that a typical (or average) student in the state demonstrates 50th percentile growth. That is, a “typical students” demonstrate “typical growth”. The power of the normative results follows when subgroups are examined (e.g., schools, district, ethnic groups, etc.). Examining subgroups in terms of the median of their student growth percentiles, it is then possible to investigate why some subgroups display lower/higher student growth than others. Moreover, because the subgroup summary statistic (i.e., the median) is composed of many individual student growth percentiles, one can break out the result and further examine the distribution of individual results.</p>
<p><strong><em>Baseline</em></strong> SGPs provide us with a way to look at normative growth through another lens. Rather than considering a single year’s cohort, baseline SGPs are referenced against a cohort of interest. This could be a “super-cohort” comprised of several years of students linked by common course/grade progressions, or a single particular cohort. In the COVID impact analyses, the 2019 cohorts were used to establish the baselines. Baseline comparisons allow us to examine whether or not the system as a whole might be improving (or declining) over time relative to the established baseline. A major assumption required here is that the scale scores are well anchored. If this assumption does not hold, then any deviation from “typical” growth may be purely an artifact of the test scaling procedure.</p>
<p>In the case of COVID impact analyses, we expected to (and did) see median SGP values well below 50 at state, district and school levels. As we move beyond 2021, we hope to see that systems are improving (recovering) over time. We would see that improvement in the form of median SGPs that are greater than 50 (what <em>was</em> typical growth in the past would now be lower growth).</p>
<p>The following script creates baseline SGPs for the 2021 7<sup>th</sup> grade ELA cohort using the complete, missing/observed and 20 imputed data sets. Several objects of interest are returned including <code>Complete_SGP</code> and <code>Missing_SGP</code>, which are typical SGP class objects from the associated data. The 20 analyses using imputation data are combined into a single data table - <code>Imputed_SGP_Data</code>. Estimates for school level values (mean scores, pooled errors, etc.) are calculated and available in the <code>SGP_Imputation_Summaries</code> object.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">##   Run Baseline SGP analyses using complete, missing (observed), and imputed data</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/SGP_Baseline_Analyses.R"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Returns `Complete_SGP`, `Missing_SGP`, `Imputed_SGP_Data` and `SGP_Imputation_Summaries`.</span></span></code></pre></div>
<p>For our analyses, we wanted to quantify COVID impact at various institutional and subgroup levels in metrics that would 1) be meaningful to both stakeholders and fellow researchers and 2) communicate additional uncertainty due to missing data. Some of the statistics we calculated included:</p>
<ul>
<li>Mean/median scale scores (2021 status)</li>
<li>Percent Proficient (2021 status)</li>
<li>Mean/median baseline SGPs (2021 growth)</li>
<li>Change scores in the above status and growth metrics (2019 to 2021)</li>
<li>Effect sizes for 2019 to 2021 changes</li>
</ul>
<p>The caterpillar plots below show 2021 school mean scale scores and baseline SGPs estimated from the analyses we just ran. In all plots <em>red</em> points and lines correspond to values from the complete data analysis, observed values are <em>black</em>, and <em>green</em> pertains to imputations. Error bars are associated with the imputations and color coded by significance levels for the difference between the imputed and observed values.</p>
<p>Plots similar to these were originally developed during the imputation method vetting process, and the <strong><em>F</em></strong> statistics corresponded to the difference between the imputations and the “true” complete values. The difference in these represent how we used such error bars and statistics with states’ observed/missing data to flag schools where the MI analyses produced significantly different assessments of schools’ status or growth than what was indicated in the missing data.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/SGP_MI_Caterpillar_Plots.R"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Creates caterpillar plots for school-level mean achievement and growth.</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    These include bands of uncertainty associated with the imputations.</span></span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_mss_cat-1.svg" width="800" style="display: block; margin: auto;"></p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_mss_pctm-1.svg" width="800" style="display: block; margin: auto;"></p>
<p>The status plots suggest that the <code>pmm</code> method does a decent job of recovering the school mean scale scores. The second plot “dissects” the caterpillar and shows the relationship between percent missing, mean scale scores and school size. As this plot suggests, and what we found in our simulations, is that the accuracy of the imputations has less to do with the percent missing in a school than it does with the size of the school.</p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_msgp_cat-1.svg" width="800" style="display: block; margin: auto;"></p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/pmm_msgp_pctm-1.svg" width="800" style="display: block; margin: auto;"></p>
<p>The growth plots show that the <code>pmm</code> method does not really help much with recovering “true” typical school growth. It is, on average, little changed from the observed values. This is also something that we found regularly in our simulation studies. Overall, measures of growth with missing data is less biased than measures of status (probably due to the fact that growth takes students’ prior achievement into account), but MI does less to correct for what bias is there.</p>
<p>We now demonstrate how to change the imputation method and re-run the analyses.</p>
</div>
</div>
<div id="data-imputation-with-2l-pan" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#data-imputation-with-2l-pan" class="anchor" aria-hidden="true"></a>Data imputation with <code>2l.pan</code><a href="#data-imputation-with-2l.pan" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>In order to change the imputation method, we will repeat the steps after we set up the <code>impute_subset</code> object. This can be an iterative process changing imputation methods, predictor factors or any other number of parameters. Here we will use the cross-sectional model (students nested within schools) that was found to be superior for correcting missing data bias in school mean/median status and growth. We will also remove <code>FRL</code> and <code>PERCENT_INST_FRL</code> from the predictors given that we know those factors were not part of our missing data generation process (and may have contributed to over-estimating the impact from other imputation method comparisons not shown here).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Specify imputation parameters for `mice::mice`</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>impute.method <span class="ot">&lt;-</span> <span class="st">"2l.pan"</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Cluster identifiers need to be integers for most 2-level methods</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>impute_subset[, SCHOOL_NUMBER <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(SCHOOL_NUMBER)]</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>my.methods <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">make.method</span>(<span class="at">data=</span>impute_subset)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>my.methods[<span class="fu">grep</span>(<span class="st">"^Z_SCORE"</span>, <span class="fu">names</span>(my.methods))] <span class="ot">&lt;-</span> impute.method</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>my.predMtrx <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">make.predictorMatrix</span>(<span class="at">data=</span>impute_subset)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="st">"ID"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="st">"SCHOOL_NUMBER"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="fu">grep</span>(<span class="st">"^Z_SCORE"</span>, <span class="fu">names</span>(my.methods)), <span class="st">"SCHOOL_NUMBER"</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="st">"SCHOOL_NUMBER"</span>, <span class="fu">grep</span>(<span class="st">"^Z_SCORE"</span>, <span class="fu">names</span>(my.methods))] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="fu">grep</span>(<span class="st">"COMPLETE_Z"</span>, <span class="fu">rownames</span>(my.predMtrx))] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># i.e. "Nothing used to predict it" -- redundant my.methods["COMPLETE_Z"] == ""</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="fu">grep</span>(<span class="st">"COMPLETE_Z"</span>, <span class="fu">rownames</span>(my.predMtrx)), ] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># i.e. "It's used to predict nothing"</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="st">"FRL"</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>my.predMtrx[<span class="st">"PERCENT_INST_FRL"</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="st">"FRL"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>my.predMtrx[, <span class="st">"PERCENT_INST_FRL"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div id="step-1b---create-new-imputed-results" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#step-1b---create-new-imputed-results" class="anchor" aria-hidden="true"></a>Step 1b - create new imputed results<a href="#step-1b---create-new-imputed-results" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>We are now ready to create our SECOND set of imputed data.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>imputed_results <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(<span class="at">data =</span> impute_subset,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> my.methods,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predictorMatrix =</span> my.predMtrx,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">m =</span> M, <span class="at">maxit =</span> MAXIT, <span class="at">seed =</span> 719589L, <span class="at">print =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We will again look at a few diagnostic plots to assess how the process went. This first plot looks at the convergence of the <code>M</code> imputations over the <code>MAXIT</code> iterations.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imputed_results)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_converge-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<p>The second plot looks at the distribution densities of the <code>M</code> imputations (in red) compared to the observed distribution (blue) for each of the imputed variables.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(imputed_results)</span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_dense-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_scat-1.svg" width="666.666666666667" style="display: block; margin: auto;"></p>
</div>
<div id="step-23---imputation-analysis-and-pooling-with-2l-pan" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#step-23---imputation-analysis-and-pooling-with-2l-pan" class="anchor" aria-hidden="true"></a>Step 2/3 - imputation analysis and pooling with <code>2l.pan</code><a href="#step-23---imputation-analysis-and-pooling-with-2l.pan" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Collect all imputation results in a list length = M</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> miceadds<span class="sc">::</span><span class="fu">mids2datlist</span>(imputed_results)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="do">###   Convert data (complete, missing, and imputed) to long format</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/Data_Retrieval_for_Analysis.R"</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    Returns objects `long_complete`, `long_amputed` and `res_long`</span></span></code></pre></div>
<div id="linear-mixed-effects-model-1" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#linear-mixed-effects-model-1" class="anchor" aria-hidden="true"></a>Linear mixed effects model<a href="#linear-mixed-effects-model-1" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>frmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"Z_SCORE ~ YEAR + COVID_IMPACT*FRL + (COVID_IMPACT | SCHOOL_NUMBER/ID)"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>lmer.ctl <span class="ot">&lt;-</span> <span class="fu">lmerControl</span>(<span class="at">check.conv.grad =</span> <span class="fu">.makeCC</span>(<span class="st">"warning"</span>, <span class="fl">0.02</span>, <span class="cn">NULL</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>true_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> frmla, <span class="at">data =</span> long_complete, <span class="at">control =</span> lmer.ctl)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>miss_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> frmla, <span class="at">data =</span> long_amputed, <span class="at">control =</span> lmer.ctl)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>imp_mods <span class="ot">&lt;-</span> <span class="fu">lmerModList</span>(<span class="at">formula=</span>frmla, <span class="at">data =</span> res_long, <span class="at">control =</span> lmer.ctl)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comp_table, <span class="at">class =</span> F, <span class="at">row.names =</span> F) <span class="co"># print out original table from `pmm`</span></span></code></pre></div>
<pre><code>##                    |         ESTIMATE         |         STD ERR         |
##      Fixed Effects | -------  ------- ------- | ------- ------- ------- |
##       Coefficients |   True   Missing Imputed |   True  Missing Imputed |
##  ----------------- | -------  ------- ------- | ------- ------- ------- |
##        (Intercept) |  -56.67   -58.77   -59.7 |    15.2   16.69   35.64 |
##       COVID_IMPACT |   -0.19    -0.18   -0.19 |    0.03    0.03    0.03 |
##   COVID_IMPACT:FRL |    0.02     0.03    0.03 |    0.02    0.02    0.02 |
##                FRL |   -0.42    -0.42   -0.42 |    0.02    0.02    0.02 |
##               YEAR |    0.03     0.03    0.03 |    0.01    0.01    0.01 |
##          t VALUE         |
##  ------- ------- ------- |
##    True  Missing Imputed |
##  ------- ------- ------- |
##    -3.73   -3.52   -1.68 |
##     -6.2    -5.7   -6.67 |
##     1.25    1.83    1.81 |
##   -17.61  -17.57  -17.83 |
##     3.74    3.53     3.9 |</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">###   Collate and print model (fixed effects) estimate comparison</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/MI_LME_Model_Comp.R"</span>)</span></code></pre></div>
<pre><code>## 
## 
##                    |         ESTIMATE         |         STD ERR         |
##      Fixed Effects | -------  ------- ------- | ------- ------- ------- |
##       Coefficients |   True   Missing Imputed |   True  Missing Imputed |
##  ----------------- | -------  ------- ------- | ------- ------- ------- |
##        (Intercept) |  -56.67   -58.77  -61.11 |    15.2   16.69   58.43 |
##       COVID_IMPACT |   -0.19    -0.18   -0.19 |    0.03    0.03    0.03 |
##   COVID_IMPACT:FRL |    0.02     0.03    0.04 |    0.02    0.02    0.02 |
##                FRL |   -0.42    -0.42   -0.41 |    0.02    0.02    0.02 |
##               YEAR |    0.03     0.03    0.03 |    0.01    0.01    0.01 |
##          t VALUE         |
##  ------- ------- ------- |
##    True  Missing Imputed |
##  ------- ------- ------- |
##    -3.73   -3.52   -1.05 |
##     -6.2    -5.7   -6.23 |
##     1.25    1.83    2.72 |
##   -17.61  -17.57  -17.32 |
##     3.74    3.53    3.97 |</code></pre>
</div>
<div id="baseline-student-growth-percentiles-1" class="section level3 hasAnchor">
<h3 class="hasAnchor">
<a href="#baseline-student-growth-percentiles-1" class="anchor" aria-hidden="true"></a>Baseline student growth percentiles<a href="#baseline-student-growth-percentiles-1" class="anchor-section" aria-label="Anchor link to header"></a>
</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">##   Run Baseline SGP analyses using complete, missing (observed), and imputed data</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/SGP_Baseline_Analyses.R"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Returns `Complete_SGP`, `Missing_SGP`, `Imputed_SGP_Data` and `SGP_Imputation_Summaries`.</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Missing_Data_Multiple_Imputation/Helper_Scripts/SGP_MI_Caterpillar_Plots.R"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Creates caterpillar plots for school-level mean achievement and growth.</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    These include bands of uncertainty associated with the imputations.</span></span></code></pre></div>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_mss_cat-1.svg" width="800" style="display: block; margin: auto;"></p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_mss_pctm-1.svg" width="800" style="display: block; margin: auto;"></p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_msgp_cat-1.svg" width="800" style="display: block; margin: auto;"></p>
<p><img src="Missing_Data_Multiple_Imputation_files/figure-html/l2pan_msgp_pctm-1.svg" width="800" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="things-to-consider" class="section level1 hasAnchor">
<h1 class="hasAnchor">
<a href="#things-to-consider" class="anchor" aria-hidden="true"></a>Things to consider:<a href="#things-to-consider" class="anchor-section" aria-label="Anchor link to header"></a>
</h1>
<ul>
<li>We have only looked at a cohort that had prior scores available. The situation is more difficult when no prior achievement information is available</li>
<li>We are only looking at 2021 results/model output. We would need to have some comparable results from 2019 in order to make meaningful assessment of COVID impact (particularly at the school level)</li>
</ul>
</div>
<div id="citations-and-references" class="section level1 hasAnchor">
<h1 class="hasAnchor">
<a href="#citations-and-references" class="anchor" aria-hidden="true"></a>Citations and References<a href="#citations-and-references" class="anchor-section" aria-label="Anchor link to header"></a>
</h1>
<div id="missing-data-simulation" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#missing-data-simulation" class="anchor" aria-hidden="true"></a>Missing Data Simulation<a href="#missing-data-simulation" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>Brand, Jaap. 1999. “Development, Implementation and Evaluation of Multiple Imputation Strategies for the Statistical Analysis of Incomplete Data Sets.” PhD thesis.</p>
<p>Schouten, Rianne Margaretha, Peter Lugtig, and Gerko Vink. 2018. “Generating Missing Values for Simulation Purposes: A Multivariate Amputation Procedure.” Journal of Statistical Computation and Simulation 88 (15): 2909–30.</p>
<p>Schouten, Rianne Margaretha, and Gerko Vink. 2021. “The Dance of the Mechanisms: How Observed Information Influences the Validity of Missingness Assumptions.” Sociological Methods &amp; Research 50 (3): 1243–58.</p>
</div>
<div id="multiple-imputation-1" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#multiple-imputation-1" class="anchor" aria-hidden="true"></a>Multiple Imputation<a href="#multiple-imputation-1" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>Demirtas, H. (2004). Simulation driven inferences for multiply imputed longitudinal datasets. Statistica neerlandica, 58(4), 466-482. <a href="https://doi.org/10.1111/j.1467-9574.2004.00271.x" class="uri">https://doi.org/10.1111/j.1467-9574.2004.00271.x</a></p>
<p>Enders, C. K. (2010). Applied missing data analysis. New York, NY: The Guilford Press.</p>
<p>Fox, J. &amp; Weisberg, S. (2018). Multiple imputation of missing data. Appendix of An R companion to applied regression, third edition. Thousand Oaks, CA: Sage Publications, Inc.</p>
<p>Miri, H. H., Hassanzadeh, J., Khaniki, S. H., Akrami, R., &amp; Sirjani, E. (2020). Accuracy of five multiple imputation methods in estimating prevalence of Type 2 diabetes based on STEPS surveys. Journal of Epidemiology and Global Health, 10(1), 36-41. <a href="https://doi.org/10.2991/jegh.k.191207.001" class="uri">https://doi.org/10.2991/jegh.k.191207.001</a></p>
<p>Nguyen, C. D., Carlin, J. B., &amp; Lee, K. J. (2017). Model checking in multiple imputation: An overview and case study. Emerging Themes in Epidemiology, 14(8). <a href="https://doi.org/10.1186/s12982-017-0062-6" class="uri">https://doi.org/10.1186/s12982-017-0062-6</a></p>
<p>Qi, L., Wang, Y.-F., &amp; He, Y. (2010). A comparison of multiple imputation and fully augmented weighted estimators for Cox regression with missing covariates. Statistics in Medicine, 29(25), 2592-2604. <a href="https://doi.org/10.1002/sim.4016" class="uri">https://doi.org/10.1002/sim.4016</a></p>
<p>Schafer, J. L. ,1997. Analysis of Incomplete Multivariate Data, New York: Chapman and Hall</p>
<p>Stuart, E. A., Azur, M., Frangakis, C., &amp; Leaf, P. (2009). Multiple imputation with large data sets: A case study of the Children’s Mental Health Initiative. American Journal of Epidemiology, 169(9), 1133–1139. <a href="https://doi.org/10.1093/aje/kwp026" class="uri">https://doi.org/10.1093/aje/kwp026</a></p>
<p>Van Buuren, S. (2018). Flexible imputation of missing data. CRC Press. <a href="https://stefvanbuuren.name/fimd/" class="uri">https://stefvanbuuren.name/fimd/</a></p>
<p>Van Buuren, S., &amp; Groothuis-Oudshoorn, K. (2011). mice: Multivariate imputation by chained equations in R. Journal of Statistical Software, 45(3), 1-67. <a href="https://www.jstatsoft.org/v45/i03/" class="uri">https://www.jstatsoft.org/v45/i03/</a></p>
<p>Vink, G., &amp; Van Buuren, S. (2014). Pooling multiple imputations when the sample happens to be the population. arXiv Pre-Print 1409.8542.</p>
<p>Zhao, J. H., &amp; Schafer, J. L. (2018). pan: Multiple imputation for multivariate panel or clustered data. R package version 1.6.</p>
</div>
<div id="data-and-analytics" class="section level2 hasAnchor">
<h2 class="hasAnchor">
<a href="#data-and-analytics" class="anchor" aria-hidden="true"></a>Data and Analytics<a href="#data-and-analytics" class="anchor-section" aria-label="Anchor link to header"></a>
</h2>
<p>Bates, D., Maechler, M., Bolker, B., &amp; Walker, S. (2015). Fitting linear mixed-effects models using lme4. <em>Journal of Statistical Software, 67</em>(1), 1-48. <a href="https://doi.org/10.18637/jss.v067.i01" class="uri">https://doi.org/10.18637/jss.v067.i01</a>.</p>
<p>Betebenner, D. W., Van Iwaarden, A. R., Domingue, B. &amp; Shang, Y. (2022). SGP: Student Growth Percentiles &amp; Percentile Growth Trajectories. R package version 1.9-9.987. URL: <a href="https://sgp.io" class="uri">https://sgp.io</a></p>
<p>Betebenner, D. W., Van Iwaarden, A. R., &amp; Domingue, B. (2021). SGPdata: Exemplar data sets for student growth percentile (SGP) analyses. R package version 25.1-0.0. <a href="https://centerforassessment.github.io/SGPdata/" class="uri">https://centerforassessment.github.io/SGPdata/</a></p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>A vignette associated with this function is also available in the <a href="https://centerforassessment.github.io/cfaTools/articles/Simulating_Missing_Data.html">package documentation</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Lengthy sections of data formatting and analysis code that do not directly deal with missing data generation, imputation, or data analysis have been extracted to standalone <code>R</code> scripts in the “Missing_Data_Multiple_Imputation/Helper_Scripts” directory<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction<span></span></a></li>
      <li>
<a href="#the-missing-data-problem">The Missing Data Problem<span></span></a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-case-for-multiple-imputation-methods">The case for multiple imputation methods<span></span></a></li>
      </ul>
</li>
      <li>
<a href="#simulating-missing-data">Simulating Missing Data<span></span></a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-retrieval-and-working-directory-setup">Data retrieval and working directory setup<span></span></a></li>
      <li><a href="#the-ampute-function">The <code>ampute</code> function<span></span></a></li>
      <li><a href="#missing-data-explorationvisualization">Missing data exploration/visualization<span></span></a></li>
      </ul>
</li>
      <li>
<a href="#multiple-imputation">Multiple Imputation<span></span></a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-three-steps-of-multiple-imputation">The three steps of multiple imputation<span></span></a></li>
      <li><a href="#multiple-imputation-with-simulated-missing-data">Multiple imputation with simulated missing data<span></span></a></li>
      <li><a href="#step-1---data-imputation">Step 1 - data imputation<span></span></a></li>
      <li><a href="#step-23---imputation-analysis-and-results-pooling">Step 2/3 - imputation analysis and results pooling<span></span></a></li>
      <li><a href="#data-imputation-with-2l-pan">Data imputation with <code>2l.pan</code><span></span></a></li>
      <li><a href="#step-1b---create-new-imputed-results">Step 1b - create new imputed results<span></span></a></li>
      <li><a href="#step-23---imputation-analysis-and-pooling-with-2l-pan">Step 2/3 - imputation analysis and pooling with <code>2l.pan</code><span></span></a></li>
      </ul>
</li>
      <li><a href="#things-to-consider">Things to consider:<span></span></a></li>
      <li>
<a href="#citations-and-references">Citations and References<span></span></a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#missing-data-simulation">Missing Data Simulation<span></span></a></li>
      <li><a href="#multiple-imputation-1">Multiple Imputation<span></span></a></li>
      <li><a href="#data-and-analytics">Data and Analytics<span></span></a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="packagePages">
  <p><b>NCME 2022 Training Session</b> is a <a href="https://centerforassessment.github.io">Center for Assessment</a> thing.</p>
</div>

<div class="author">
  <p>Developed &amp; Maintained by <a href="https://github.com/dbetebenner"><img class="img-author" src="https://centerforassessment.github.io/assets/dbetebenner.png" height="20"> Damian W. Betebenner</a>, <a href="https://github.com/adamvi"><img class="img-author" src="https://centerforassessment.github.io/assets/adamvi.png" height="20"> Adam R. Van Iwaarden</a>, <a href="https://github.com/ndadey"><img class="img-author" src="https://avatars0.githubusercontent.com/u/17909944" height="20"> Nathan Dadey</a> &amp; <a href="https://github.com/alliecooperman"><img class="img-author" src="https://avatars.githubusercontent.com/u/82226809?v=4" height="20"> Allie Cooperman</a>.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98997021-1', 'auto');
  ga('send', 'pageview');
</script></footer>
</div>

  </body>
</html>
